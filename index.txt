<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Práctica de Física: Fluidos</title>
    <!-- Tailwind CSS para un diseño moderno y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- KaTeX para renderizar LaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOV3CQDEZwgMAFdscFADSQLiCasiAcA5dAyMI3YtnRU9OFEdUT4z" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctMQanyES51" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f7fa; /* Light cyan, similar to water */
            color: #004d40; /* Dark cyan for text */
            background-image:
                radial-gradient(ellipse at top left, rgba(0, 150, 136, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(0, 150, 136, 0.1) 0%, transparent 50%);
        }
        .quiz-panel {
            background-color: #ffffff;
            border: 1px solid #b2ebf2;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .option-btn {
            background-color: #e0f7fa;
            border-color: #b2ebf2;
            transition: all 0.2s ease-in-out;
            color: #004d40;
            text-align: left;
            padding: 1rem;
            margin: 0.5rem 0;
            display: block;
        }
        .option-btn:not(:disabled):hover {
            border-color: #009688; /* Teal */
            background-color: #b2dfdb; /* Lighter teal */
            color: #004d40;
        }
        .option-btn.correct {
            background-color: #80cbc4; /* Greenish teal */
            color: #004d40;
            border-color: #009688;
        }
        .option-btn.incorrect {
            background-color: #ffcdd2; /* Reddish pink */
            color: #b71c1c;
            border-color: #ef9a9a;
        }
        .option-btn:disabled { cursor: not-allowed; opacity: 0.8; }
        .primary-btn {
            background-color: #009688; /* Teal */
            color: white;
            transition: background-color 0.2s;
        }
        .primary-btn:hover { background-color: #00796b; /* Darker teal */ }
        .feedback-list li::before {
            content: '✓';
            color: #009688;
            font-weight: bold;
            margin-right: 0.75rem;
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        .fade-out { animation: fadeOut 0.5s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="quiz-container" class="w-full max-w-3xl quiz-panel p-6 sm:p-8 rounded-lg shadow-2xl transition-opacity duration-500 my-8">

        <div id="start-screen" class="text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 tracking-tight">Práctica de Fluidos 🌊</h1>
            <p class="text-lg text-gray-600 mt-2 mb-6">Módulo: Densidad, Presión y Principio de Arquímedes</p>
            <p class="text-gray-700 mb-8 text-left">Resuelve los siguientes problemas. Selecciona un modo para empezar:</p>
            <div class="flex flex-col sm:flex-row gap-4" id="mode-selection-btns">
                <button id="linear-mode-btn" class="primary-btn w-full font-bold py-3 px-6 rounded-lg text-lg">Modo Lineal</button>
                <button id="select-mode-btn" class="primary-btn w-full font-bold py-3 px-6 rounded-lg text-lg">Seleccionar Problema</button>
            </div>
            <div id="problem-list" class="flex flex-col gap-4 mt-6 hidden"></div>
        </div>

        <div id="question-screen" class="hidden">
            <div class="w-full bg-gray-200 h-2 rounded-full mb-4">
                <div id="progress-bar" class="bg-teal-500 h-full rounded-full" style="width: 0%; transition: width 0.5s ease-in-out;"></div>
            </div>
            <div id="question-content" class="transition-opacity duration-500">
                <p class="text-sm font-semibold text-teal-600" id="question-counter"></p>
                <h2 class="text-xl sm:text-2xl text-gray-800 mt-2 font-semibold" id="question-text"></h2>
                
                <div id="circuit-image-container" class="my-4 text-center">
                    <img id="circuit-image" class="inline-block border border-gray-300 rounded-lg" src="" alt="Diagrama del problema" style="max-height: 250px;">
                </div>

                <div id="options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 my-6"></div>

                <div id="feedback-container" class="hidden p-4 rounded-lg mt-4 text-sm border-l-4">
                    <p class="font-bold text-lg mb-3 flex items-center" id="feedback-title"></p>
                    <p class="font-bold text-gray-800 mb-2 text-base">Solución Detallada:</p>
                    <div id="feedback-explanation"></div>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 mt-6">
                <button id="back-btn" class="primary-btn w-full font-bold py-3 px-6 rounded-lg text-lg hidden">Anterior</button>
                <button id="next-btn" class="primary-btn w-full font-bold py-3 px-6 rounded-lg text-lg hidden">Siguiente</button>
            </div>
            <button id="main-menu-btn" class="primary-btn w-full mt-4 font-bold py-3 px-6 rounded-lg text-lg">Menú Principal</button>
        </div>

        <div id="results-screen" class="hidden text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">¡Práctica Completada! 🌊</h2>
            <p class="text-xl text-gray-600 mb-6">Resultado Final:</p>
            <div class="bg-gray-200 border-2 border-teal-500 text-teal-600 text-5xl font-bold rounded-full w-36 h-36 flex items-center justify-center mx-auto mb-8 shadow-lg" id="score-display">
            </div>
            <p id="rank-text" class="text-xl text-teal-600 font-semibold mb-8"></p>
            <button id="restart-btn" class="primary-btn w-full font-bold py-3 px-6 rounded-lg text-lg">Reiniciar Práctica</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                ]
            });
        });

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        const quizData = [
            {
                name: "El Capitán",
                question: "<strong>1.</strong> El volumen aproximado del monolito de granito conocido como El Capitán en el Parque Nacional Yosemite es de aproximadamente $10^8 \\, m^3$. ¿Cuál es su masa aproximada? (La densidad del granito es $\\rho \\approx 2700 \\, kg/m^3$)",
                options: [
                    { text: "$2.7 \\times 10^{11} \\, kg$", correct: true },
                    { text: "$2.7 \\times 10^{8} \\, kg$", correct: false },
                    { text: "$3.7 \\times 10^{11} \\, kg$", correct: false },
                    { text: "$3.7 \\times 10^{8} \\, kg$", correct: false }
                ],
                solution: {
                    text: `La masa se calcula usando la fórmula de densidad: $\\rho = \\dfrac{m}{V}$.<br>
                           Despejando la masa ($m$): $m = \\rho \\cdot V$<br>
                           Sustituyendo los valores:<br>
                           $m = (2700 \\, kg/m^3)(10^8 \\, m^3) = 2.7 \\times 10^3 \\times 10^8 \\, kg$<br>
                           $m = 2.7 \\times 10^{11} \\, kg$`
                }
            },
            {
                name: "Masa de aire",
                question: "<strong>2.</strong> ¿Cuál es la masa aproximada de aire en una sala de estar de dimensiones $5.6 \\, m \\times 3.6 \\, m \\times 2.4 \\, m$? (La densidad del aire es $\\rho \\approx 1.29 \\, kg/m^3$)",
                options: [
                    { text: "$62.4 \\, kg$", correct: true },
                    { text: "$48.4 \\, kg$", correct: false },
                    { text: "$37.3 \\, kg$", correct: false },
                    { text: "$71.9 \\, kg$", correct: false }
                ],
                solution: {
                    text: `Primero, calculamos el volumen ($V$) de la sala:<br>
                           $V = longitud \\times ancho \\times altura$<br>
                           $V = (5.6 \\, m)(3.6 \\, m)(2.4 \\, m) = 48.384 \\, m^3$<br><br>
                           Luego, usamos la fórmula de densidad ($\\rho = \\dfrac{m}{V}$) para encontrar la masa:<br>
                           $m = \\rho \\cdot V$<br>
                           $m = (1.29 \\, kg/m^3)(48.384 \\, m^3) \\approx 62.41 \\, kg$`
                }
            },
            {
                name: "Mochila de oro",
                question: "<strong>3.</strong> Si intentaras contrabandear bloques de oro llenando tu mochila, cuyas dimensiones son $54 \\, cm \\times 31 \\, cm \\times 22 \\, cm$, ¿cuál sería su masa? (La densidad del oro es $\\rho \\approx 19300 \\, kg/m^3$)",
                options: [
                    { text: "$710 \\, kg$", correct: true },
                    { text: "$850 \\, kg$", correct: false },
                    { text: "$610 \\, kg$", correct: false },
                    { text: "$580 \\, kg$", correct: false }
                ],
                solution: {
                    text: `Primero, convertimos las dimensiones de la mochila a metros para el cálculo del volumen:<br>
                           $54 \\, cm = 0.54 \\, m$<br>
                           $31 \\, cm = 0.31 \\, m$<br>
                           $22 \\, cm = 0.22 \\, m$<br><br>
                           Calculamos el volumen ($V$) de la mochila:<br>
                           $V = (0.54 \\, m)(0.31 \\, m)(0.22 \\, m) \\approx 0.0368 \\, m^3$<br><br>
                           Usamos la fórmula de densidad ($\\rho = \\dfrac{m}{V}$) para encontrar la masa:<br>
                           $m = \\rho \\cdot V$<br>
                           $m = (19300 \\, kg/m^3)(0.0368 \\, m^3) \\approx 710.04 \\, kg$`
                }
            },
            {
                name: "Gravedad específica",
                question: "<strong>4.</strong> Una botella tiene una masa de $35.00 \\, g$ cuando está vacía y $98.44 \\, g$ cuando está llena de agua. Cuando está llena de otro líquido, la masa es de $89.22 \\, g$. ¿Cuál es la gravedad específica de este otro líquido? (La densidad del agua es $\\rho_{agua} = 1000 \\, kg/m^3$)",
                options: [
                    { text: "$0.85$", correct: true },
                    { text: "$1.05$", correct: false },
                    { text: "$1.2$", correct: false },
                    { text: "$0.75$", correct: false }
                ],
                solution: {
                    text: `La gravedad específica (GE) es la relación entre la densidad de un material y la del agua. $GE = \\dfrac{\\rho_{liquido}}{\\rho_{agua}} = \\dfrac{m_{liquido}}{m_{agua}}$ (asumiendo el mismo volumen).<br><br>
                           Masa del agua: $m_{agua} = 98.44 \\, g - 35.00 \\, g = 63.44 \\, g$<br>
                           Masa del otro líquido: $m_{liquido} = 89.22 \\, g - 35.00 \\, g = 54.22 \\, g$<br><br>
                           Gravedad específica (GE):<br>
                           $GE = \\dfrac{m_{liquido}}{m_{agua}} = \\dfrac{54.22 \\, g}{63.44 \\, g} \\approx 0.8546$`
                }
            },
            {
                name: "Mezcla de fluidos",
                question: "<strong>5.</strong> Si se agregan $4.0 \\, L$ de una solución de anticongelante con una gravedad específica de $0.80$ a $5.0 \\, L$ de agua para hacer una mezcla de $9.0 \\, L$, ¿cuál es la gravedad específica de la mezcla?",
                options: [
                    { text: "$0.91$", correct: true },
                    { text: "$0.85$", correct: false },
                    { text: "$0.95$", correct: false },
                    { text: "$0.88$", correct: false }
                ],
                solution: {
                    text: `La masa total de la mezcla es la suma de las masas. Asumiendo $\\rho_{agua} = 1 \\, kg/L$.<br>
                           $m_{anti} = (0.80)(4.0 \\, L) = 3.2 \\, kg$<br>
                           $m_{agua} = (1.0)(5.0 \\, L) = 5.0 \\, kg$<br>
                           $m_{total} = 3.2 \\, kg + 5.0 \\, kg = 8.2 \\, kg$<br><br>
                           La densidad promedio es $\\rho_{mezcla} = \\dfrac{m_{total}}{V_{total}} = \\dfrac{8.2 \\, kg}{9.0 \\, L} \\approx 0.911 \\, kg/L$.<br><br>
                           La gravedad específica es: $GE_{mezcla} = \\dfrac{\\rho_{mezcla}}{\\rho_{agua}} = \\dfrac{0.911 \\, kg/L}{1 \\, kg/L} \\approx 0.91$`
                }
            },
            {
                name: "Modelo de la Tierra",
                question: `<strong>6.</strong> La Tierra no es una esfera uniforme. Considera un modelo simple de la Tierra dividido en tres regiones: núcleo interno, núcleo externo y manto, cada una con densidad constante:<br><br>
                            <table class="table-auto w-full text-sm text-left text-gray-700">
                                <thead class="text-xs text-gray-900 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Región</th>
                                        <th scope="col" class="px-6 py-3">Radio (km)</th>
                                        <th scope="col" class="px-6 py-3">Densidad (kg/m³)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="bg-white border-b hover:bg-gray-50"><td class="px-6 py-4 font-medium text-gray-900">Núcleo interno</td><td class="px-6 py-4">0–1220</td><td class="px-6 py-4">13,000</td></tr>
                                    <tr class="bg-gray-50 border-b hover:bg-gray-100"><td class="px-6 py-4 font-medium text-gray-900">Núcleo externo</td><td class="px-6 py-4">1220–3480</td><td class="px-6 py-4">11,100</td></tr>
                                    <tr class="bg-white border-b hover:bg-gray-50"><td class="px-6 py-4 font-medium text-gray-900">Manto</td><td class="px-6 py-4">3480–6371</td><td class="px-6 py-4">4400</td></tr>
                                </tbody>
                            </table>
                            <br>Utilizando este modelo simplificado de tres capas, calcula cuál sería la densidad promedio de nuestro planeta.`,
                options: [
                    { text: "$5500 \\, kg/m^3$", correct: true },
                    { text: "$4800 \\, kg/m^3$", correct: false },
                    { text: "$6200 \\, kg/m^3$", correct: false },
                    { text: "$9500 \\, kg/m^3$", correct: false }
                ],
                solution: {
                    text: `<p class="mb-2">La densidad promedio es $\\rho_{prom} = \\dfrac{m_{total}}{V_{total}}$. El volumen de una esfera es $V = \\dfrac{4}{3}\\pi r^3$.</p>
                           <p class="mb-2"><strong>1. Núcleo interno:</strong><br>$V_{ni} = \\dfrac{4}{3}\\pi (1.22 \\times 10^6 m)^3 \\approx 7.61 \\times 10^{18} \\, m^3$<br>$m_{ni} = (13000) V_{ni} \\approx 9.89 \\times 10^{22} \\, kg$</p>
                           <p class="mb-2"><strong>2. Núcleo externo (capa):</strong><br>$V_{ne} = \\dfrac{4}{3}\\pi [(3.48 \\times 10^6)^3 - (1.22 \\times 10^6)^3] \\approx 1.69 \\times 10^{20} \\, m^3$<br>$m_{ne} = (11100) V_{ne} \\approx 1.88 \\times 10^{24} \\, kg$</p>
                           <p class="mb-2"><strong>3. Manto (capa):</strong><br>$V_{manto} = \\dfrac{4}{3}\\pi [(6.371 \\times 10^6)^3 - (3.48 \\times 10^6)^3] \\approx 9.06 \\times 10^{20} \\, m^3$<br>$m_{manto} = (4400) V_{manto} \\approx 3.99 \\times 10^{24} \\, kg$</p>
                           <p class="mb-2"><strong>4. Totales:</strong><br>$m_{total} = m_{ni} + m_{ne} + m_{manto} \\approx 5.96 \\times 10^{24} \\, kg$<br>$V_{total} = \\dfrac{4}{3}\\pi(6.371 \\times 10^6 m)^3 \\approx 1.08 \\times 10^{21} \\, m^3$</p>
                           <p>$\\rho_{promedio} = \\dfrac{5.96 \\times 10^{24} \\, kg}{1.08 \\times 10^{21} \\, m^3} \\approx 5500 \\, kg/m^3$.</p>`
                }
            },
            {
                name: "Altura de columna",
                question: "<strong>7.</strong> Estima la presión necesaria para elevar una columna de agua a la misma altura que un pino de $46 \\, m$ de altura. (La densidad del agua es $\\rho \\approx 1000 \\, kg/m^3$)",
                options: [
                    { text: "$4.5 \\times 10^5 \\, Pa$", correct: true },
                    { text: "$4.5 \\times 10^3 \\, Pa$", correct: false },
                    { text: "$4.5 \\times 10^4 \\, Pa$", correct: false },
                    { text: "$4.5 \\times 10^6 \\, Pa$", correct: false }
                ],
                solution: {
                    text: `La presión hidrostática es $P = \\rho gh$.<br>
                           $P = (1000 \\, kg/m^3)(9.8 \\, m/s^2)(46 \\, m)$<br>
                           $P = 450,800 \\, Pa = 4.508 \\times 10^5 \\, Pa$.`
                }
            },
            {
                name: "Presión en tacones",
                question: "<strong>8.</strong> Una persona de 56 kg está de pie sobre un suelo de madera. Calcula la presión que ejerce si usa zapatos con: (a) un tacón puntiagudo de $0.45 \\, cm^2$ de área, y (b) un tacón ancho de $16 \\, cm^2$ de área.",
                options: [
                    { text: "a) $1.2 \\times 10^7 \\, Pa$, b) $3.4 \\times 10^5 \\, Pa$", correct: true },
                    { text: "a) $2.4 \\times 10^6 \\, Pa$, b) $6.8 \\times 10^4 \\, Pa$", correct: false },
                    { text: "a) $1.2 \\times 10^6 \\, Pa$, b) $3.4 \\times 10^4 \\, Pa$", correct: false },
                    { text: "a) $2.4 \\times 10^7 \\, Pa$, b) $6.8 \\times 10^5 \\, Pa$", correct: false }
                ],
                solution: {
                    text: `La presión es $P = \\dfrac{F}{A}$. La fuerza es el peso, $F = mg = (56 \\, kg)(9.8 \\, m/s^2) = 548.8 \\, N$.<br><br>
                           <strong>a) Tacón puntiagudo:</strong><br>
                           $A = 0.45 \\, cm^2 = 0.45 \\times 10^{-4} \\, m^2$<br>
                           $P = \\dfrac{548.8 \\, N}{0.45 \\times 10^{-4} \\, m^2} \\approx 1.22 \\times 10^7 \\, Pa$.<br><br>
                           <strong>b) Tacón ancho:</strong><br>
                           $A = 16 \\, cm^2 = 16 \\times 10^{-4} \\, m^2$<br>
                           $P = \\dfrac{548.8 \\, N}{16 \\times 10^{-4} \\, m^2} \\approx 3.43 \\times 10^5 \\, Pa$.`
                }
            },
            {
                name: "Presión en piscina",
                question: `<strong>9.</strong> Imagina una piscina de $28.0 \\, m \\times 8.5 \\, m$ con una profundidad constante de $1.8 \\, m$. Responde: <strong>a.</strong> ¿Cuál es la presión absoluta y la fuerza total que soporta el fondo de la piscina? <strong>b.</strong> A esa misma profundidad, ¿cuál es la presión ejercida sobre una de las paredes laterales?`,
                options: [
                    { text: "a) $2.83 \\times 10^7 \\, N, 1.19 \\times 10^5 \\, Pa$<br>b) $1.19 \\times 10^5 \\, Pa$", correct: true },
                    { text: "a) $4.20 \\times 10^6 \\, N, 1.76 \\times 10^4 \\, Pa$<br>b) $1.76 \\times 10^4 \\, Pa$", correct: false },
                    { text: "a) $2.83 \\times 10^7 \\, N, 1.01 \\times 10^5 \\, Pa$<br>b) $1.01 \\times 10^5 \\, Pa$", correct: false },
                    { text: "a) $4.20 \\times 10^6 \\, N, 1.19 \\times 10^5 \\, Pa$<br>b) $1.19 \\times 10^5 \\, Pa$", correct: false }
                ],
                solution: {
                    text: `<strong>a. Fondo:</strong><br>
                           Presión hidrostática: $P_{hidro} = \\rho gh = (1000)(9.8)(1.8) = 1.76 \\times 10^4 \\, Pa$.<br>
                           Presión absoluta: $P_{abs} = P_{atm} + P_{hidro} = 1.013 \\times 10^5 + 1.76 \\times 10^4 = 1.19 \\times 10^5 \\, Pa$.<br>
                           Área: $A = (28.0)(8.5) = 238 \\, m^2$.<br>
                           Fuerza total: $F = P_{abs} \\cdot A = (1.19 \\times 10^5)(238) \\approx 2.83 \\times 10^7 \\, N$.<br><br>
                           <strong>b. Lado de la piscina:</strong><br>
                           La presión a una profundidad dada es la misma en todas las direcciones. $P = 1.19 \\times 10^5 \\, Pa$.`
                }
            },
            {
                name: "Fuerza atmosférica",
                question: "<strong>10.</strong> La atmósfera ejerce una presión enorme sobre todos los objetos. Para una mesa de $1.7 \\, m \\times 2.6 \\, m$: <strong>(a)</strong> Calcula la fuerza total que actúa sobre la superficie superior. <strong>(b)</strong> ¿Qué fuerza total actúa hacia arriba en la superficie inferior de la mesa?",
                options: [
                    { text: "a) $4.5 \\times 10^5 \\, N$, b) $4.5 \\times 10^5 \\, N$", correct: true },
                    { text: "a) $2.0 \\times 10^5 \\, N$, b) $2.0 \\times 10^5 \\, N$", correct: false },
                    { text: "a) $4.5 \\times 10^5 \\, N$, b) $0 \\, N$", correct: false },
                    { text: "a) $2.0 \\times 10^5 \\, N$, b) $4.5 \\times 10^5 \\, N$", correct: false }
                ],
                solution: {
                    text: `El área es $A = (1.7 \\, m)(2.6 \\, m) = 4.42 \\, m^2$.<br>
                           La fuerza es $F = P \\cdot A = (1.013 \\times 10^5 \\, Pa)(4.42 \\, m^2) \\approx 4.48 \\times 10^5 \\, N$.<br>
                           La atmósfera empuja por igual en la parte superior e inferior, por lo que las fuerzas son iguales.`
                }
            },
            {
                name: "Barómetro de alcohol",
                question: "<strong>11.</strong> ¿Qué tan alto estaría el nivel en un barómetro de alcohol a presión atmosférica normal? ($\rho_{alcohol} \\approx 790 \\, kg/m^3$, $P_{atm} \\approx 1.013 \\times 10^5 \\, Pa$)",
                options: [
                    { text: "$13.1 \\, m$", correct: true },
                    { text: "$10.2 \\, m$", correct: false },
                    { text: "$8.5 \\, m$", correct: false },
                    { text: "$1.01 \\, m$", correct: false }
                ],
                solution: {
                    text: `La presión atmosférica es igual a la presión de la columna: $P_{atm} = \\rho gh$.<br>
                           Despejando la altura: $h = \\dfrac{P_{atm}}{\\rho g} = \\dfrac{1.013 \\times 10^5 \\, Pa}{(790 \\, kg/m^3)(9.8 \\, m/s^2)} \\approx 13.08 \\, m$.`
                }
            },
            {
                name: "Profundidad de Tarzán",
                question: "<strong>12.</strong> Tarzán respira bajo el agua a través de una caña. Si sus pulmones pueden soportar una diferencia de presión de $-85 \\, mm-Hg$, ¿a qué profundidad máxima podría estar? ($\rho_{agua} \\approx 1000 \\, kg/m^3$)",
                options: [
                    { text: "$1.15 \\, m$", correct: true },
                    { text: "$0.85 \\, m$", correct: false },
                    { text: "$0.55 \\, m$", correct: false },
                    { text: "$1.52 \\, m$", correct: false }
                ],
                solution: {
                    text: `Primero, convertimos la presión de $mm-Hg$ a Pascales, usando $\\rho_{Hg} = 13600 \\, kg/m^3$.<br>
                           $P = \\rho_{Hg} g h_{Hg} = (13600)(9.8)(0.085) \\approx 11328 \\, Pa$.<br>
                           Esta es la presión del agua que debe contrarrestar: $P = \\rho_{agua} g h_{agua}$.<br>
                           $h_{agua} = \\dfrac{P}{\\rho_{agua} g} = \\dfrac{11328 \\, Pa}{(1000)(9.8)} \\approx 1.15 \\, m$.`
                }
            },
            {
                name: "Elevador hidráulico",
                question: "<strong>13.</strong> La presión manométrica máxima en un elevador hidráulico es de $17.0 \\, atm$. ¿Cuál es la masa más grande que puede levantar si el diámetro de salida es de $25.5 \\, cm$?",
                options: [
                    { text: "$8.98 \\times 10^3 \\, kg$", correct: true },
                    { text: "$4.70 \\times 10^3 \\, kg$", correct: false },
                    { text: "$2.35 \\times 10^4 \\, kg$", correct: false },
                    { text: "$1.50 \\times 10^4 \\, kg$", correct: false }
                ],
                solution: {
                    text: `$P = 17.0 \\, atm \\times \\dfrac{1.013 \\times 10^5 \\, Pa}{1 \\, atm} = 1.722 \\times 10^6 \\, Pa$.<br>
                           El radio es $r = \\dfrac{0.255 \\, m}{2} = 0.1275 \\, m$. El área es $A = \\pi r^2 \\approx 0.0511 \\, m^2$.<br>
                           La fuerza máxima es $F = P \\cdot A = (1.722 \\times 10^6)(0.0511) \\approx 8.8 \\times 10^4 \\, N$.<br>
                           La masa es $m = \\dfrac{F}{g} = \\dfrac{8.8 \\times 10^4 \\, N}{9.8 \\, m/s^2} \\approx 8978 \\, kg$.`
                }
            },
            {
                name: "Masa del coche",
                question: "<strong>14.</strong> La presión manométrica en las cuatro llantas de un automóvil es de $240 \\, kPa$. Si cada llanta tiene un área de contacto de $190 \\, cm^2$, estime la masa del coche.",
                options: [
                    { text: "$1.86 \\times 10^3 \\, kg$", correct: true },
                    { text: "$1.21 \\times 10^3 \\, kg$", correct: false },
                    { text: "$2.05 \\times 10^3 \\, kg$", correct: false },
                    { text: "$1.53 \\times 10^3 \\, kg$", correct: false }
                ],
                solution: {
                    text: `La fuerza total de las llantas soporta el peso del coche. $P = \\dfrac{F}{A}$.<br>
                           Área total: $A_{total} = 4 \\times (190 \\, cm^2) = 760 \\, cm^2 = 0.076 \\, m^2$.<br>
                           Presión: $P = 240 \\, kPa = 240 \\times 10^3 \\, Pa$.<br>
                           Fuerza total: $F = P \\cdot A_{total} = (240 \\times 10^3)(0.076) = 18240 \\, N$.<br>
                           Esta fuerza es el peso del coche, $W = mg$.<br>
                           $m = \\dfrac{W}{g} = \\dfrac{18240 \\, N}{9.8 \\, m/s^2} \\approx 1861 \\, kg$.`
                }
            },
            {
                name: "Hierro en mercurio",
                question: "<strong>15.</strong> ¿Qué fracción de un trozo de hierro estará sumergida cuando flote en mercurio? ($\\rho_{hierro} \\approx 7870 \\, kg/m^3$, $\\rho_{mercurio} \\approx 13600 \\, kg/m^3$)",
                options: [
                    { text: "0.58", correct: true },
                    { text: "1.73", correct: false },
                    { text: "0.78", correct: false },
                    { text: "0.42", correct: false }
                ],
                solution: {
                    text: `Para flotar, el empuje es igual al peso: $F_{empuje} = Peso_{objeto}$.<br>
                           $\\rho_{fluido} V_{sumergido} g = \\rho_{objeto} V_{total} g$<br>
                           La fracción sumergida es $\\dfrac{V_{sumergido}}{V_{total}} = \\dfrac{\\rho_{hierro}}{\\rho_{mercurio}}$.<br>
                           Fracción = $\\dfrac{7870}{13600} \\approx 0.578$.`
                }
            },
            {
                name: "Roca lunar",
                question: "<strong>16.</strong> Una roca lunar de $9.28 \\, kg$ tiene una masa aparente de $6.18 \\, kg$ sumergida en agua. ¿Cuál es la densidad de la roca? ($\\rho_{agua} = 1000 \\, kg/m^3$)",
                options: [
                    { text: "$2994 \\, kg/m^3$", correct: true },
                    { text: "$1994 \\, kg/m^3$", correct: false },
                    { text: "$1500 \\, kg/m^3$", correct: false },
                    { text: "$3100 \\, kg/m^3$", correct: false }
                ],
                solution: {
                    text: `La masa del agua desplazada es $m_{agua} = 9.28 \\, kg - 6.18 \\, kg = 3.10 \\, kg$.<br>
                           El volumen del agua desplazada (y de la roca) es $V_{roca} = \\dfrac{m_{agua}}{\\rho_{agua}} = \\dfrac{3.10 \\, kg}{1000 \\, kg/m^3} = 0.0031 \\, m^3$.<br>
                           La densidad de la roca es $\\rho_{roca} = \\dfrac{m_{real}}{V_{roca}} = \\dfrac{9.28 \\, kg}{0.0031 \\, m^3} \\approx 2994 \\, kg/m^3$.`
                }
            },
            {
                name: "Casco de barco",
                question: "<strong>17.</strong> Una grúa está rescatando un casco de acero de $18,000 \\, kg$ del fondo del mar. Calcula la tensión que debe soportar el cable de la grúa en dos momentos: <strong>(a)</strong> cuando el casco está completamente sumergido, y <strong>(b)</strong> justo cuando está completamente fuera del agua. ($\\rho_{acero} \\approx 7850 \\, kg/m^3$, $\\rho_{agua} = 1000 \\, kg/m^3$)",
                options: [
                    { text: "a) $1.54 \\times 10^5 \\, N$, b) $1.76 \\times 10^5 \\, N$", correct: true },
                    { text: "a) $1.76 \\times 10^5 \\, N$, b) $1.76 \\times 10^5 \\, N$", correct: false },
                    { text: "a) $1.98 \\times 10^5 \\, N$, b) $1.76 \\times 10^5 \\, N$", correct: false },
                    { text: "a) $2.24 \\times 10^4 \\, N$, b) $1.76 \\times 10^5 \\, N$", correct: false }
                ],
                solution: {
                    text: `<strong>(b) Tensión fuera del agua:</strong><br>
                           La tensión es igual al peso: $T_b = mg = (18000)(9.8) = 1.76 \\times 10^5 \\, N$.<br><br>
                           <strong>(a) Tensión sumergido:</strong><br>
                           Volumen del casco: $V = \\dfrac{m}{\\rho_{acero}} = \\dfrac{18000}{7850} \\approx 2.29 \\, m^3$.<br>
                           Empuje: $F_{empuje} = \\rho_{agua} V g = (1000)(2.29)(9.8) \\approx 22,442 \\, N$.<br>
                           Tensión: $T_a = Peso - F_{empuje} = 1.76 \\times 10^5 - 22442 \\approx 1.54 \\times 10^5 \\, N$.`
                }
            },
            {
                name: "Globo de helio",
                question: "<strong>18.</strong> Un globo meteorológico esférico tiene un radio de $7.15 \\, m$ y una masa estructural de $930 \\, kg$. Si se llena con helio, ¿cuál es la masa máxima de la carga (instrumentos, etc.) que puede elevar desde el suelo? ($\\rho_{aire} \\approx 1.29 \\, kg/m^3$, $\\rho_{helio} \\approx 0.179 \\, kg/m^3$)",
                options: [
                    { text: "$770 \\, kg$", correct: true },
                    { text: "$1700 \\, kg$", correct: false },
                    { text: "$1040 \\, kg$", correct: false },
                    { text: "$265 \\, kg$", correct: false }
                ],
                solution: {
                    text: `La fuerza de elevación neta es el empuje menos el peso total (globo + helio).<br><br>
                           1. Volumen del globo: $V = \\dfrac{4}{3}\\pi r^3 = \\dfrac{4}{3}\\pi (7.15)^3 \\approx 1530.6 \\, m^3$.<br>
                           2. Empuje (peso del aire desplazado): $F_{empuje} = \\rho_{aire} V g = (1.29)(1530.6)(9.8) \\approx 19,335 \\, N$.<br>
                           3. Peso del helio: $W_{helio} = \\rho_{helio} V g = (0.179)(1530.6)(9.8) \\approx 2680 \\, N$.<br>
                           4. Peso de la estructura: $W_{estructura} = mg = (930)(9.8) = 9114 \\, N$.<br>
                           5. Fuerza neta de elevación: $F_{neta} = F_{empuje} - W_{helio} - W_{estructura} = 19335 - 2680 - 9114 = 7541 \\, N$.<br>
                           Masa de la carga: $m_{carga} = \\dfrac{F_{neta}}{g} = \\dfrac{7541 \\, N}{9.8 \\, m/s^2} \\approx 770 \\, kg$.`
                }
            }
        ];

        let currentQuestionIndex = 0;
        let isLinearMode = false;
        let score = 0;
        let totalQuestions = quizData.length;

        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultsScreen = document.getElementById('results-screen');
        const linearModeBtn = document.getElementById('linear-mode-btn');
        const selectModeBtn = document.getElementById('select-mode-btn');
        const restartBtn = document.getElementById('restart-btn');
        const nextBtn = document.getElementById('next-btn');
        const backBtn = document.getElementById('back-btn');
        const mainMenuBtn = document.getElementById('main-menu-btn');
        const questionCounter = document.getElementById('question-counter');
        const questionText = document.getElementById('question-text');
        const circuitImageContainer = document.getElementById('circuit-image-container');
        const circuitImage = document.getElementById('circuit-image');
        const optionsContainer = document.getElementById('options-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackExplanation = document.getElementById('feedback-explanation');
        const scoreDisplay = document.getElementById('score-display');
        const progressBar = document.getElementById('progress-bar');
        const questionContent = document.getElementById('question-content');
        const rankText = document.getElementById('rank-text');
        const problemList = document.getElementById('problem-list');
        const modeSelectionBtns = document.getElementById('mode-selection-btns');
        
        function renderKatex() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                ],
                // trust: true // Use if you have complex custom macros
            });
        }

        function showNextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                setupQuestion(currentQuestionIndex);
            } else if (isLinearMode) {
                showResults();
            }
        }
        
        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                setupQuestion(currentQuestionIndex);
            }
        }

        function showResults() {
            startScreen.classList.add('hidden');
            questionScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            scoreDisplay.textContent = `${score}/${totalQuestions}`;
            const percentage = (score / totalQuestions) * 100;
            let rank = "Aprendiz de Física";
            if (percentage >= 75) rank = "Maestro de Fluidos";
            if (percentage >= 95) rank = "Arquímedes Moderno";
            rankText.textContent = `RANGO OBTENIDO: ${rank}`;
        }

        function setupQuestion(qIndex) {
            questionContent.classList.remove('fade-in');
            void questionContent.offsetWidth; // Trigger reflow
            questionContent.classList.add('fade-in');

            const questionData = quizData[qIndex];
            
            questionCounter.textContent = `PROBLEMA ${qIndex + 1} DE ${totalQuestions}`;
            questionText.innerHTML = questionData.question;
            
            circuitImageContainer.classList.add('hidden');
            
            optionsContainer.innerHTML = '';
            let shuffledOptions = [...questionData.options];
            if (!questionData.answered) {
                shuffleArray(shuffledOptions);
            }
            
            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.innerHTML = option.text;
                button.classList.add('option-btn', 'w-full', 'p-4', 'border-2', 'rounded-lg', 'text-left', 'font-medium');
                button.dataset.text = option.text; 
                button.onclick = () => selectAnswer(button);
                optionsContainer.appendChild(button);
            });
            
            feedbackContainer.classList.add('hidden');
            backBtn.classList.toggle('hidden', !isLinearMode || qIndex === 0);
            nextBtn.classList.toggle('hidden', !isLinearMode || qIndex === totalQuestions - 1);
            mainMenuBtn.classList.remove('hidden');

            const answeredQuestions = quizData.filter(q => q.answered).length;
            const progress = (answeredQuestions / totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
            
            renderKatex();
        }

        function selectAnswer(selectedButton) {
            const questionData = quizData[currentQuestionIndex];
            if (questionData.answered) return;
            questionData.answered = true;
            
            const selectedText = selectedButton.dataset.text;
            const correctOption = questionData.options.find(opt => opt.correct);
            const isCorrect = correctOption.text === selectedText;
            
            const optionButtons = optionsContainer.querySelectorAll('.option-btn');
            optionButtons.forEach(btn => btn.disabled = true);
            
            feedbackExplanation.innerHTML = questionData.solution.text;
            
            const iconCorrect = '✅';
            const iconIncorrect = '❌';

            if (isCorrect) {
                if(isLinearMode) score++;
                selectedButton.classList.add('correct');
                feedbackContainer.className = 'p-4 rounded-lg mt-4 text-sm border-l-4 border-teal-500 bg-teal-100 text-teal-800';
                feedbackTitle.innerHTML = `${iconCorrect} <span>¡Correcto!</span>`;
            } else {
                selectedButton.classList.add('incorrect');
                feedbackContainer.className = 'p-4 rounded-lg mt-4 text-sm border-l-4 border-red-500 bg-red-100 text-red-800';
                feedbackTitle.innerHTML = `${iconIncorrect} <span>Incorrecto. La respuesta correcta es: ${correctOption.text}</span>`;

                optionButtons.forEach(btn => {
                    if (btn.dataset.text === correctOption.text) {
                        btn.classList.add('correct');
                    }
                });
            }
            
            feedbackContainer.classList.remove('hidden');
            renderKatex();

            const answeredQuestions = quizData.filter(q => q.answered).length;
            const progress = (answeredQuestions / totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
            
            if (isLinearMode && answeredQuestions === totalQuestions) {
                setTimeout(showResults, 2000);
            }
        }

        function resetQuizState() {
            quizData.forEach(q => q.answered = false);
            currentQuestionIndex = 0;
            score = 0;
            progressBar.style.width = `0%`;
        }

        function renderProblemList() {
            problemList.innerHTML = '';
            quizData.forEach((problem, index) => {
                const problemBtn = document.createElement('button');
                problemBtn.innerHTML = `Problema ${index + 1}: ${problem.name}`;
                problemBtn.classList.add('option-btn', 'w-full', 'p-4', 'border-2', 'rounded-lg', 'text-left', 'font-medium');
                problemBtn.onclick = () => {
                    currentQuestionIndex = index;
                    isLinearMode = false;
                    startScreen.classList.add('hidden');
                    questionScreen.classList.remove('hidden');
                    backBtn.classList.add('hidden');
                    nextBtn.classList.add('hidden');
                    setupQuestion(currentQuestionIndex);
                };
                problemList.appendChild(problemBtn);
            });
        }

        linearModeBtn.addEventListener('click', () => {
            isLinearMode = true;
            resetQuizState();
            startScreen.classList.add('hidden');
            questionScreen.classList.remove('hidden');
            resultsScreen.classList.add('hidden');
            setupQuestion(currentQuestionIndex);
        });

        selectModeBtn.addEventListener('click', () => {
            modeSelectionBtns.classList.add('hidden');
            problemList.classList.remove('hidden');
            renderProblemList();
        });

        backBtn.addEventListener('click', showPreviousQuestion);
        nextBtn.addEventListener('click', showNextQuestion);
        
        mainMenuBtn.addEventListener('click', () => {
            questionScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            modeSelectionBtns.classList.remove('hidden');
            problemList.classList.add('hidden');
            resetQuizState();
        });

        restartBtn.addEventListener('click', () => {
            resultsScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            modeSelectionBtns.classList.remove('hidden');
            problemList.classList.add('hidden');
            resetQuizState();
        });
    </script>
</body>
</html>


